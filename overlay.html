<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Stealth Overlay</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
            user-select: none;
            -webkit-app-region: drag;
            height: 100vh;
        }
        
        .bar-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 50%, #2a2a2a 100%);
            border: 1px solid #3a3a3a;
            border-radius: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .left-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00d4aa;
            box-shadow: 0 0 8px rgba(0, 212, 170, 0.6);
            animation: pulse 2s infinite;
        }
        
        .status-text {
            font-size: 14px;
            font-weight: 500;
            color: #ffffff;
        }
        
        .center-section {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
            justify-content: center;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #b0b0b0;
        }
        
        .feature-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #666;
        }
        
        .right-section {
            display: flex;
            align-items: center;
            gap: 12px;
            -webkit-app-region: no-drag;
        }
        
        .hotkey-display {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 11px;
            color: #b0b0b0;
            font-weight: 500;
        }
        
        .control-button {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 18px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #b0b0b0;
            font-size: 12px;
        }
        
        .control-button:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.25);
            color: #ffffff;
        }
        
        .settings-button {
            background: none;
            border: none;
            color: #b0b0b0;
            cursor: pointer;
            font-size: 16px;
            padding: 6px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .settings-button:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #ffffff;
        }
        
        @keyframes pulse {
            0% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 0 0 8px rgba(0, 212, 170, 0.6);
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.1);
                box-shadow: 0 0 12px rgba(0, 212, 170, 0.8);
            }
            100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 0 0 8px rgba(0, 212, 170, 0.6);
            }
        }
        
        .dev-controls {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px;
            display: none;
            gap: 8px;
            flex-direction: column;
            -webkit-app-region: no-drag;
            z-index: 1000;
        }
        
        .dev-controls.show {
            display: flex;
        }
        
        .dev-button {
            background: #333;
            border: 1px solid #555;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s ease;
        }
        
        .dev-button:hover {
            background: #444;
        }
        
        .opacity-display {
            font-size: 10px;
            color: #666;
            text-align: center;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="bar-container">
        <!-- Left section: Status -->
        <div class="left-section">
            <div class="status-dot"></div>
            <div class="status-text">Stealth Mode</div>
        </div>
        
        <!-- Center section: Features -->
        <div class="center-section">
            <div class="feature-item">
                <div class="feature-dot"></div>
                <span>Screen protected</span>
            </div>
            <div class="feature-item">
                <div class="feature-dot"></div>
                <span>Capture blocked</span>
            </div>
            <div class="feature-item">
                <div class="feature-dot"></div>
                <span>Share invisible</span>
            </div>
        </div>
        
        <!-- Right section: Controls -->
        <div class="right-section">
            <div class="hotkey-display">‚åò‚áßH</div>
            <button class="settings-button" onclick="toggleDevControls()" title="Developer Controls">‚öôÔ∏è</button>
        </div>
    </div>

    <!-- Developer controls (hidden by default) -->
    <div class="dev-controls" id="devControls">
        <button class="dev-button" onclick="testCapture()">Test Flash</button>
        <button class="dev-button" onclick="toggleOpacity()">Lower Opacity</button>
        <button class="dev-button" onclick="resetOpacity()">Reset Opacity</button>
        <button class="dev-button" onclick="toggleAlwaysOnTop()">Toggle Pin</button>
        <div class="opacity-display" id="opacityDisplay">90%</div>
        <button class="dev-button" onclick="minimizeWindow()">Minimize</button>
        <button class="dev-button" onclick="closeWindow()">Close</button>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        // Developer controls toggle
        function toggleDevControls() {
            const devControls = document.getElementById('devControls');
            devControls.classList.toggle('show');
        }
        
        // Window control functions using IPC
        async function minimizeWindow() {
            await ipcRenderer.invoke('minimize-window');
        }
        
        async function closeWindow() {
            await ipcRenderer.invoke('close-window');
        }
        
        let alwaysOnTop = true;
        async function toggleAlwaysOnTop() {
            alwaysOnTop = await ipcRenderer.invoke('toggle-always-on-top');
            console.log('Always on top:', alwaysOnTop);
        }
        
        let currentOpacity = 0.9;
        async function toggleOpacity() {
            const opacityDisplay = document.getElementById('opacityDisplay');
            
            if (currentOpacity === 0.9) {
                currentOpacity = 0.7;
                console.log('‚ö†Ô∏è WARNING: Higher transparency may affect capture protection!');
            } else if (currentOpacity === 0.7) {
                currentOpacity = 0.5;
                console.log('‚ö†Ô∏è DANGER: Very transparent - protection may be broken!');
            } else if (currentOpacity === 0.5) {
                currentOpacity = 0.3;
                console.log('üö® EXTREME: Almost invisible - protection likely broken!');
            } else if (currentOpacity === 0.3) {
                currentOpacity = 0.1;
                console.log('üíÄ CRITICAL: Barely visible - protection definitely broken!');
            } else if (currentOpacity === 0.1) {
                currentOpacity = 0.05;
                console.log('üëª GHOST MODE: Almost transparent - this should break everything!');
            } else {
                currentOpacity = 0.9;
                console.log('‚úÖ Back to safe opacity level');
            }
            
            await ipcRenderer.invoke('set-opacity', currentOpacity);
            opacityDisplay.textContent = Math.round(currentOpacity * 100) + '%';
            console.log('Current opacity:', currentOpacity);
        }
        
        async function resetOpacity() {
            currentOpacity = 0.9;
            await ipcRenderer.invoke('set-opacity', currentOpacity);
            const opacityDisplay = document.getElementById('opacityDisplay');
            opacityDisplay.textContent = '90%';
            console.log('‚úÖ Reset to safe opacity level (0.9)');
        }
        
        async function testCapture() {
            // Flash the window to help with testing
            const originalBg = document.body.style.background;
            const flashColor = currentOpacity < 0.3 ? '#00ff00' : '#ff0000';
            
            document.body.style.background = flashColor;
            
            setTimeout(() => {
                document.body.style.background = originalBg;
            }, 1000);
            
            console.log(`Testing capture protection at opacity ${currentOpacity} - window flashing ${flashColor}`);
            console.log('Try taking a screenshot NOW to test if this window is hidden');
            
            // Get native handle for debugging
            const hwnd = await ipcRenderer.invoke('get-native-handle');
            console.log('Native window handle (HWND):', hwnd);
        }
        
        // Log protection status
        console.log('Stealth overlay loaded');
        console.log('Content protection should be active');
        console.log('Test with: PrtSc, Snipping Tool, Zoom share, OBS');
        console.log('Hotkey: Ctrl+Shift+H to hide/show window');
        console.log('Click the gear icon for developer controls');
    </script>
</body>
</html>